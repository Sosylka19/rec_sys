stages:
  - deploy


before_script:
  - export PATH="/Applications/Docker.app/Contents/Resources/bin:$PATH"
  - docker --version
  - docker-compose --version

deploy:db:
  stage: deploy
  tags:
    - shell
  script:
    - cd db_service
    - echo "Deploying db_app to remote server."
    - docker-compose up -d --build
  rules:
    - changes:
      - db_service/**/*

deploy:ml:
  stage: deploy
  tags:
    - shell
  script:
    - cd ml_service
    - echo "Deploying ml_app to remote server."
    - docker-compose up -d --build
  rules:
    - changes:
      - ml_service/**/*

  

deploy:krakend:
  stage: deploy
  tags:
    - shell
  script:
    - cd krakend
    - echo "Deploying krakenb_app to remote server."
    - docker-compose up -d --build
  rules:
    - changes:
      - krakend/**/*

deploy:nginx:
  stage: deploy
  tags:
    - shell
  script:
    - cd nginx
    - echo "Deploying nginx_app to remote server."
    - docker-compose up -d --build
  rules:
    - changes:
      - nginx/**/*

deploy:tg-client:
  stage: deploy
  tags: 
    - shell
  script:
    - cd tg_client
    - echo "Deploying tg)client to remote server"
    - docker-compsoe up -d --build
  rules:
    - changes:
      - tg_client/**/*